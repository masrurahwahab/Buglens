<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authenticating... - BugLens</title>

   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

  
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/auth.css">

    <style>
        .callback-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #FDF8F3 0%, #F5E6D3 50%, #E8DCC8 100%);
        }

        .callback-content {
            text-align: center;
            background: white;
            padding: 3rem 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(139, 69, 19, 0.15);
            max-width: 400px;
        }

        .callback-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #8B4513, #654321);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            animation: pulse 1.5s infinite;
        }

        .callback-icon i {
            font-size: 2rem;
            color: white;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(139, 69, 19, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(139, 69, 19, 0);
            }
        }

        .callback-title {
            color: #8B4513;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .callback-text {
            color: #6c757d;
        }
    </style>
</head>
<body>
<div class="callback-container">
    <div class="callback-content">
        <div class="callback-icon">
            <i class="bi bi-arrow-repeat"></i>
        </div>
        <h3 class="callback-title">Completing Sign In...</h3>
        <p class="callback-text">Please wait while we authenticate your account</p>
    </div>
</div>

<script>
 
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const error = urlParams.get('error');

    if (error) {
       
        window.location.href = `login.html?error=${encodeURIComponent(error)}`;
    } else if (token) {
        
        localStorage.setItem('authToken', token);

   
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            const payload = JSON.parse(jsonPayload);
            localStorage.setItem('userEmail', payload.email || '');
            localStorage.setItem('userName', payload.name || payload.email || '');
            localStorage.setItem('userId', payload.sub || '');
        } catch (e) {
            console.error('Error decoding token:', e);
        }


        setTimeout(() => {
            window.location.href = 'index.html';
        }, 1500);
    } else {
     
        window.location.href = 'login.html?error=Authentication failed';
    }
</script>
</body>
</html>